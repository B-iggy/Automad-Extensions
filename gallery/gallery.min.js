/*!
 *	GALLERY
 *	Extension for the Automad CMS
 *
 *	Copyright (c) 2014 by Marc Anton Dahmen
 *	http://marcdahmen.de
 *
 *	Licensed under the MIT license.
 */
(function(a){a.fn.Gallery=function(){var i=a(this);if(i.length>0){var o=a('<div class="gallerySlideshow"></div>').appendTo("body").hide(),e=a('<div class="overlay"></div>').appendTo(o).fadeTo(0,0.9),n=a('<div class="caption"></div>').appendTo(o),d=a('<div class="captionText"></div>').appendTo(n),m=a('<a class="closeSlideshow" href="#"></a>').appendTo(o),c=a('<a class="prevImage" href="#"></a>').appendTo(o),g=a('<a class="nextImage" href="#"></a>').appendTo(o),f=false,k,l,h;displayCaption=function(p){d.html(p);n.fadeIn(300)};m.click(function(){o.fadeOut(300,function(){bigImage.remove()});f=false;return false});c.click(function(){if(h>0){h-=1}else{h=i.length-1}b(h);return false});g.click(function(){if(i.length>(h+1)){h+=1}else{h=0}b(h);return false});var j=function(){var q=bigImage.width(),s=bigImage.height(),r=o.height()/o.width(),p=s/q;if((k>o.width())||(l>o.height())){if(r>p){q=o.width();s=q*p}else{s=o.height();q=s/p}}if((o.height()-s)!=0){bigTop=((o.height()-s)/2)+"px"}else{bigTop=0}if((o.width()-q)!=0){bigLeft=((o.width()-q)/2)+"px"}else{bigLeft=0}bigImage.css({width:q+"px",height:s+"px",top:bigTop,left:bigLeft});bigImage.fadeIn(300)};i.each(function(q){var r=a(this),p=r.attr("href"),s=r.find("img").data("caption");if(!s){s=r.find("img").attr("title")}r.click(function(){h=q;bigImage=a('<img alt="">').appendTo(o).hide().one("load",function(){k=bigImage.width();l=bigImage.height();j();displayCaption(s);f=true}).attr("src",p);o.fadeIn(300);return false})});var b=function(q){var p=i.eq(q).attr("href"),r=i.eq(q).find("img").data("caption");if(!r){r=i.eq(q).find("img").attr("title")}bigImage.fadeOut(200);n.fadeOut(200);setTimeout(function(){bigImage.remove();bigImage=a('<img alt="">').appendTo(o).hide().one("load",function(){k=bigImage.width();l=bigImage.height();j();displayCaption(r)}).attr("src",p)},200)};a(window).resize(function(){if(f){j()}})}}})(jQuery);$(document).ready(function(){$(".gallery a").Gallery()});